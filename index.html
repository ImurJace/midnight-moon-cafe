<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - The Midnight Moon Cafe</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5efe7;
            color: #4a4a4a;
        }
        .header {
            background-color: #c2a477;
            color: white;
            padding: 20px;
            font-size: 2em;
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
            position: relative;
        }
        .user-info {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-info img {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid white;
        }
        .button-box {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background-color: #c2a477;
            color: white;
            font-size: 0.9em;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s ease-in-out;
            border: none;
            cursor: pointer;
        }
        .button-box:hover {
            background-color: #a38c67;
        }
        .discord-icon {
            width: 18px;
            height: 18px;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
            text-align: center;
        }
        #menu-section {
            display: none; /* Initially hidden */
        }
    </style>
</head>
<body>
    <div class="header">
        The Midnight Moon Cafe
        <div class="user-info">
            <a href="https://discord.com/oauth2/authorize?client_id=1353300567442723009&redirect_uri=https://discord.com/oauth2/authorize?client_id=1353300567442723009&response_type=code&redirect_uri=https%3A%2F%2Fimurjace.github.io%2Fmidnight-moon-cafe%2Findex.html&scope=identify" 
               class="button-box" id="login-btn">
                <img src="https://upload.wikimedia.org/wikipedia/en/6/60/Discord_logo_2015.svg" class="discord-icon" alt="Discord">
                Sign In
            </a>
            <div id="user-profile" style="display: none;">
                <img id="user-avatar" src="" alt="Profile">
                <span id="username"></span>
                <button class="button-box" id="logout-btn">ðŸšª Log out</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>Welcome to The Midnight Moon Cafe</h2>
        <p class="welcome-text">A cozy place where coffee meets comfort. Whether you're here for a quick espresso or a relaxing evening, weâ€™ve got the perfect cup waiting for you.</p>
        <div id="menu-section">
            <a href="menu.html" class="button-box">â˜• View Menu</a>
        </div>
        <a href="https://discord.gg/zwQqrnmW8g" class="button-box" target="_blank">ðŸ’¬ Join Discord</a>
    </div>

    <div class="footer">Â© 2025 The Midnight Moon Cafe. All Rights Reserved.</div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const loginBtn = document.getElementById("login-btn");
            const logoutBtn = document.getElementById("logout-btn");
            const userProfile = document.getElementById("user-profile");
            const userAvatar = document.getElementById("user-avatar");
            const username = document.getElementById("username");
            const menuSection = document.getElementById("menu-section");

            // Check if user is already logged in
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const accessToken = fragment.get("access_token");

            if (accessToken) {
                fetch("https://discord.com/api/users/@me", {
                    headers: { Authorization: `Bearer ${accessToken}` }
                })
                .then(response => response.json())
                .then(data => {
                    loginBtn.style.display = "none";
                    userProfile.style.display = "flex";
                    username.textContent = data.username;
                    userAvatar.src = `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png?size=40`;
                    localStorage.setItem("discordUser", JSON.stringify(data)); // Save user info
                    menuSection.style.display = "block"; // Show menu when logged in
                })
                .catch(() => {
                    localStorage.removeItem("discordUser");
                    window.location.href = "index.html"; // Redirect if error
                });
            }

            logoutBtn.addEventListener("click", function() {
                localStorage.removeItem("discordUser"); // Clear data
                window.location.href = "index.html"; // Refresh page
            });

            // If user is already logged in from local storage
            const savedUser = localStorage.getItem("discordUser");
            if (savedUser) {
                const data = JSON.parse(savedUser);
                loginBtn.style.display = "none";
                userProfile.style.display = "flex";
                username.textContent = data.username;
                userAvatar.src = `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png?size=40`;
                menuSection.style.display = "block"; // Show menu when logged in
            }
        });
    </script>
</body>
</html>
